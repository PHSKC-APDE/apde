% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/load_table_from_file.R
\name{load_table_from_file}
\alias{load_table_from_file}
\title{Load a data file to a SQL table}
\usage{
load_table_from_file(
  conn,
  server = NULL,
  overall = T,
  ind_yr = F,
  years = NULL,
  combine_yr = F,
  config = NULL,
  config_url = NULL,
  config_file = NULL,
  to_schema = NULL,
  to_table = NULL,
  server_path = NULL,
  db_name = NULL,
  file_path = NULL,
  field_term = NULL,
  row_term = NULL,
  first_row = 2,
  truncate = T,
  drop_index = T,
  test_schema = NULL
)
}
\arguments{
\item{conn}{SQL server connection created using \code{odbc} package.}

\item{server}{Name of server being used (only applies if using a YAML file).
Useful if the same table is loaded to multiple servers but with different names
or schema. Note that this is different from the \emph{server_path} argument that is
used as part of the BCP command; the \emph{server} argument can be any name a user
wants whereas \emph{server_path} must be the actual server name.}

\item{overall}{Load a single table instead of a table for each calendar year.
Mutually exclusive with \emph{ind_yr} option. Default is TRUE.}

\item{ind_yr}{Load multiple tables, one for each calendar year, with a year suffix
on each table name (e.g., mcaid_elig_2014). Mutually exclusive with \emph{overall} option.
If using this option, the list of years should be provided via the \emph{years} argument or
a \emph{years} variable in the YAML file. Default is FALSE.}

\item{years}{Vector of individual years to make tables for (if not using YAML input).}

\item{combine_yr}{Union year-specific files into a single table. Only applies
if ind_yr = T. Default is FALSE.}

\item{config}{Name of object in global environment that contains configuration
information. Use one of \code{config}, \code{config_url}, or \code{config_file}.
Should be in a YAML format with at least the following variables:
\emph{to_schema}, \emph{to_table}, \emph{server_path}, \emph{db_name}, and \emph{file_path}, with possibly
\emph{field_term}, \emph{row_term}, and \emph{first_row}.
\emph{to_schema} and \emph{to_table}, \emph{server_path}, and \emph{db_name} should all be nested under
the server name if applicable, other variables should not (but might be nested
under a calendar year).}

\item{config_url}{URL of a YAML config file. Use one of \code{config}, \code{config_url}, or
\code{config_file}. Note the requirements under \code{config}.}

\item{config_file}{File path of a YAML config file. Use one of \code{config}, \code{config_url}, or
\code{config_file}. Note the requirements under \code{config}.}

\item{to_schema}{Name of the schema to apply the index to (if not using YAML input).}

\item{to_table}{Name of the table to apply the index to (if not using YAML input).}

\item{server_path}{Name of the SQL server to connect to (if not using YAML input).}

\item{db_name}{Name of the database to use (if not using YAML input).}

\item{file_path}{File path of data to be loaded (if not using YAML input). If
ind_yr = T, this should be a named vector with the format
\emph{c("2014" = "//path1/folder1/file1.ext", "2015" = "//path1/folder1/file2.ext")}
where the name matches the years to load.}

\item{field_term}{Field terminator in the data (if not using YAML input). If
using ind_yr = T and the terminator differs between calendar years, this should
be a named vector with the format \emph{c("overall" = "\t", "2014" = "\|", "2016" = "\0")}
where "overall" supplies the default terminator and the other names match the years
that differ. Do not use a named vector if overall = T or if there is no variation
between years. The BCP default is \\t.}

\item{row_term}{Row terminator in the data (if not using YAML input). If
using ind_yr = T and the terminator differs between calendar years, this should
be a named vector with the format \emph{c("overall" = "\n", "2014" = "\r", "2016" = "\0")}
where "overall" supplies the default terminator and the other names match the years
that differ. Do not use a named vector if overall = T or if there is no variation
between years. The BCP default is \\n.}

\item{first_row}{Row number of the first line of data (if not using YAML input).
Default is 2 (assumes a header row). Currently this must be the same for all years.}

\item{truncate}{Truncate existing table prior to loading. Default is TRUE.}

\item{drop_index}{Drop any existing indices prior to loading data. This can speed
loading times substantially. Use \code{add_index} to restore the index after. Default is TRUE.}

\item{test_schema}{Write to a temporary/development schema when testing out table creation.
Will use the to_schema (specified or in the YAML file) to make a new table name of
{to_schema}_{to_table}. Schema must already exist in the database. Most useful
when the user has an existing YAML file and does not want to overwrite it.
Only 1,000 rows will be loaded to each table. Default is NULL.}
}
\description{
\code{load_table_from_file} loads a file data to a SQL table using specified variables or a YAML config file.
}
\details{
This function loads a data file to an already existing SQL table using
specified variables or a YAML configuration file. The function is essentially a
wrapper for the SQL bulk copy program (BCP) utility using integrated authorization.
Users can specify some input functions (e.g., to_table) and rely on the config file
for the rest of the necessary information.
For all arguments that could be specified or come from a YAML file, the hierarchy is
specified > argument under server in YAML > argument not under server in YAML.
Note that arguments that should not vary between servers (e.g., row_terminator)
should not be listed under a server in the YAML file.
\subsection{Example YAML file with no server or individual years}{

(Assume the indentation is appropriate)\preformatted{to_schema: raw
to_table: mcaid_elig
*optional other components like a qa_schema and qa_table, index name, vars, etc.*
server_path: KCITSQLABCD51
db_name: PHClaims
file_path: //path123/importdata/Data/kc_elig_20210519.txt
field_term: \\t
row_term: \\n
}
}

\subsection{Example YAML file with servers (phclaims, hhsaw) and individual years}{

(Assume the indentation is appropriate)\preformatted{phclaims:
    to_schema: raw
    to_table: mcaid_elig
    server_path: KCITSQLABCD51
    db_name: PHClaims
hhsaw:
    to_schema: raw
    to_table: mciad_elig
    server_path: kcitazxyz20.database.windows.net
    db_name: hhs_analytics_workspace
*optional other components like a qa_schema and qa_table, index name, vars, etc.*
field_term: \\t
row_term: \\n
years:
    2014
    2015
    2016
2014:
    file_path: //path123/importdata/Data/kc_elig_2014.txt
    field_term: \\|
    row_term: \\r
2015:
    file_path: //path123/importdata/Data/kc_elig_2015.txt  
2016:
    file_path: //path123/importdata/Data/kc_elig_2016.txt
    field_term: \\0
    row_term: \\0
}
}
}
\examples{
\dontrun{
load_table(conn = db_claims, server = "hhsaw", config = load_config)
load_table(conn = db_claims, server = "phclaims", 
config_url = "https://raw.githubusercontent.com/PHSKC-APDE/claims_data/load_mcaid_raw.R",
overall = F, ind_yr = T)
}

}
